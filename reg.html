<!DOCTYPE html>
<html lang="en">
<head>
    <title>12COMP firebase</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://www.w3schools.com/w3css/4/w3.css" />
    <link rel="stylesheet" type="text/css" href="./css/style.css" />

    <!-- firebase UI CSS -->
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
</head>
<body style="height: 550px; margin: 0; background: linear-gradient(135deg,#97c2f0 , #d197f0); background-size: cover; background-repeat: no-repeat;">

<h2 style="text-align: center; font-size: 40px; font-family: Copperplate, 'Copperplate Gothic Light', fantasy, serif;">
  REGISTRATION FORM!
</h2>
<h3> please enter in your details </h3>

<form id="f_userDetails" onsubmit="return false;">
  <label for="i_displayName">displayName:</label><br />
  <input type="text" id="i_displayName" name="i_displayName" required /><br />

  <label for="i_age">Age:</label><br />
  <input type="text" id="i_age" name="i_age" required /><br />

  <label for="i_sex">Sex:</label><br />
  <input type="text" id="i_sex" name="i_sex" required /><br />

  <label for="i_email">Email:</label><br />
  <input type="text" id="i_email" name="i_email" required /><br />

  <button id="registerBtn" style="font-size: 20px; padding: 15px 40px; margin-top: 50px;">
    REGISTER
  </button>
</form>

<script type="module">
import { fb_initialise, fb_writerecord } from './fb_io.mjs';
fb_initialise(); // must be called BEFORE any read/write

  // Function to get input values and write to Firebase
  function getUserInput() {
    console.log('getUserInput()');

    const form = document.getElementById('f_userDetails');
    if (form.checkValidity()) {
      const displayName = document.getElementById("i_displayName").value;
      const age = document.getElementById("i_age").value;
      const sex = document.getElementById("i_sex").value;
      const email = document.getElementById("i_email").value;

      console.log("displayName:", displayName);
      console.log("Age:", age);
      console.log("Sex:", sex);
      console.log("Email:", email);

      const userDetails = {
        displayName,
        age,
        sex,
        email,
        uid: sessionStorage.getItem('uid'),
        photoURL: sessionStorage.getItem('photoURL') || 'n/a'  // fallback
      };

      // Call the Firebase write function
      fb_writerecord(userDetails);

    } else {
      console.log("Form is not valid!");
    }
  }

  // Attach event listener to button
  document.getElementById('registerBtn').addEventListener('click', getUserInput);
</script>

</body>
</html>
